{% extends 'base.html' %}


{% block head_scripts %}
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<link rel="stylesheet" href="https://cdn.quilljs.com/1.3.6/quill.snow.css">
<link rel="stylesheet" href="/static/css/quill-emoji.css">
<script src="/static/quill-emoji.js"></script>
<style>
    #editor-container {
        min-height: 150px;
    }
</style>
{% endblock %}

{% block content %}

{% if links_url %}
<div class="links">
    {% if links_url[0] %}<a href="{{ links_url[0][0] }}">–ü–µ—Ä–≤–æ–µ —á—Ç–µ–Ω–∏–µ</a><br>{% else %}<br>{% endif %}
    {% if links_url[1] %}<a href="{{ links_url[1][0] }}">–í—Ç–æ—Ä–æ–µ —á—Ç–µ–Ω–∏–µ</a><br>{% else %}<br>{% endif %}
    {% if links_url[2] %}<a href="{{ links_url[2][0] }}">–¢—Ä–µ—Ç—å–µ —á—Ç–µ–Ω–∏–µ</a><br>{% else %}<br>{% endif %}
</div>
{% endif %}


<form action="" method="post">
    <fieldset id="create-tx">
        <p>
            <label for="short_subject">–¢–µ–º–∞ (–í —Ä–µ–µ—Å—Ç—Ä)</label>
            <input type="text" id="short_subject" name="short_subject" required placeholder="–¢–µ–º–∞ –≤ —Ä–µ–µ—Å—Ç—Ä"
                   value="{{ short_subject }}">
        </p>
        <legend>–í–æ–ø—Ä–æ—Å</legend>
        <div class="question_number">
            <label for="question_number">–ù–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞:</label>
            <div class="input-group">
                <input type="text" id="question_number" name="question_number" class="question_number" required
                       placeholder="–ù–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —á—Ç–æ–± –ø–æ–ª—É—á–∏—Ç—å" value="{{ question_number }}"
                       {% if links_url %} disabled {% endif %}>
                <button type="button" id="loadsDecisionNum" class="loadsDecisionNum button secondary"
                        {% if links_url %} disabled {% endif %}>üîç
                </button>
            </div>
        </div>
        <p>
            <input type="hidden" name="inquiry" id="inquiry">
            <label for="editor-container">–í–æ–ø—Ä–æ—Å (–ò–¥–µ—Ç –≤ –≥—Ä—É–ø–ø—É –±–µ–∑ —Ç–µ–º—ã)</label>
        </p>
        <div id="editor-container">
            {{ inquiry|safe }}
        </div>
        <p>
            <label>–ß—Ç–µ–Ω–∏–µ</label>
            <label><input type="radio" name="reading" value="1" {{ 'checked' if reading == 1 else '' }}> –ü–µ—Ä–≤–æ–µ
                —á—Ç–µ–Ω–∏–µ</label>
            <label><input type="radio" name="reading" value="2" {{ 'checked' if reading == 2 else '' }}> –í—Ç–æ—Ä–æ–µ
                —á—Ç–µ–Ω–∏–µ</label>
            <label><input type="radio" name="reading" value="3" {{ 'checked' if reading == 3 else '' }}> –¢—Ä–µ—Ç—å–µ
                —á—Ç–µ–Ω–∏–µ</label>
        </p>
        <input type="submit" class="button primary" value="–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å">
    </fieldset>
</form>

<script>
    var form = document.querySelector('form');
    form.onsubmit = function() {
        var html = quill.root.innerHTML;
        document.getElementById('inquiry').value = html;
    };

    var toolbarOptions = {
        container: [
            ['bold', 'italic', 'underline', 'strike', 'code'],
            ['link'],
            ['clean'],
            ['emoji']
        ],
        handlers: {
            'emoji': function () {}
        }
    }

    var quill = new Quill('#editor-container', {
        modules: {
            "toolbar": toolbarOptions,
            "emoji-toolbar": true,
            "emoji-shortname": true
        },
        theme: 'snow',
    });

    async function getNumber() {
        if (document.querySelector("#question_number").disabled) {
            return; // Exit the function if disabled
        }

        fetch(`/decision/number`)
        .then(response => {
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            return response.json();
        })
        .then(data => {
            document.querySelector("#question_number").value = data.number;
            var currentText = quill.root.innerHTML; // Fetch current content from Quill editor
            var shortSubject = document.querySelector("#short_subject").value;
            quill.root.innerHTML = "<b>–í–æ–ø—Ä–æ—Å " + data.number + ": "+ shortSubject +"</b><br> " + currentText; // Update content in Quill editor
        })
        .catch(error => {
            console.log("There was a problem with the fetch operation:", error.message);
        });
    }
    document.getElementById('loadsDecisionNum').addEventListener('click', getNumber);


</script>

{% endblock %}
